<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>我的雲端書櫃</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        // 將預設字體改為思源宋體 (Serif)
                        sans: ['"Noto Serif TC"', 'serif'],
                        serif: ['"Noto Serif TC"', 'serif'],
                    },
                    colors: {
                        // 日系配色調整：更溫潤、低飽和
                        paper: '#fdfcf8', // 極淺的米白，像高級信紙
                        ink: '#4a4036',   // 深茶褐色，比純黑柔和
                        sub: '#8c8680',   // 淺灰褐
                        
                        // 木頭色系 (主色調) - 類似亞麻、拿鐵色
                        wood: {
                            50: '#f9f6f2',
                            100: '#f0ece6',
                            200: '#e2dacf',
                            300: '#d0c4b4',
                            400: '#bba896',
                            500: '#a68f78', // 主按鈕色
                            600: '#8c735a',
                            700: '#735d49',
                        },
                        // 抹茶綠色系 (用於完成/狀態)
                        sage: {
                            50: '#f4f7f5',
                            100: '#e6ebe8',
                            200: '#cbdad1',
                            500: '#8da696', // 莫蘭迪綠
                            600: '#6f8778',
                            text: '#5c7366'
                        },
                        // 豆沙紅色系 (用於棄書/刪除)
                        dried: {
                            50: '#fbf7f7',
                            100: '#f5ebeb',
                            200: '#ebd5d5',
                            500: '#c48c90', // 乾燥玫瑰紅
                            600: '#a86f73',
                            text: '#8f5a5e'
                        },
                        // 石頭灰色系 (用於未讀/中性)
                        stone: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            400: '#a8a29e',
                            500: '#78716c',
                            600: '#57534e',
                            text: '#57534e'
                        },
                        gold: {
                            400: '#dec56f', // 較低調的金色
                            500: '#c9af55',
                        }
                    },
                    boxShadow: {
                        // 調整陰影為更輕柔的擴散感
                        'sm': '0 1px 2px 0 rgba(74, 64, 54, 0.05)',
                        'md': '0 4px 6px -1px rgba(74, 64, 54, 0.05), 0 2px 4px -1px rgba(74, 64, 54, 0.03)',
                        'lg': '0 10px 15px -3px rgba(74, 64, 54, 0.05), 0 4px 6px -2px rgba(74, 64, 54, 0.03)',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        .animate-fade-in-down {
            animation: fadeIn 0.4s ease-out forwards;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-modal-in {
            animation: modalIn 0.3s ease-out forwards;
        }

        html {
            font-size: 95%; /* 稍微放大一點點，閱讀更舒適 */
            letter-spacing: 0.05em; /* 增加字距，日系風格關鍵 */
        }

        @media (max-width: 768px) {
            html {
                font-size: 110%; 
            }
            input, select, textarea {
                padding-top: 0.6rem;
                padding-bottom: 0.6rem;
            }
        }

        input, textarea, select {
            font-size: 1rem !important; 
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* 自定義選取顏色 */
        ::selection {
            background-color: #e2dacf; /* wood-200 */
            color: #4a4036;
        }
    </style>
</head>
<body class="bg-paper text-ink pb-10 font-serif leading-relaxed">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            BookOpen, Search, Plus, Trash2, CheckCircle, BookX, 
            Calendar, User, LogIn, RefreshCw, TrendingUp, Link as LinkIcon, FileText, PenTool, Trophy, Hourglass, Star, X, Tag, RotateCcw, AlertTriangle, Filter, LogOut, MessageSquare, Edit3
        } from 'https://esm.sh/lucide-react@0.344.0';
        
        // --- Firebase Config ---
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDX1-Lwc5_u_fwV9P25xh32dVF8uVNT0QU",
            authDomain: "my-reading-tracker-58f69.firebaseapp.com",
            projectId: "my-reading-tracker-58f69",
            storageBucket: "my-reading-tracker-58f69.firebasestorage.app",
            messagingSenderId: "370802674969",
            appId: "1:370802674969:web:efb1c045e0028925154988",
            measurementId: "G-52EWLNG7ST"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "my-reading-app"; 
        const ESTIMATE_WORDS_PER_PAGE = 350;

        const DEFAULT_CATEGORIES = [
            "文學", "小說", "散文", "詩歌", "心理勵志", "商業理財", "社會科學", "歷史文化", 
            "藝術設計", "生活風格", "自然科普", "旅遊", "飲食", "親子教養", "輕小說", "漫畫",
            "玄幻", "推理", "科幻", "懸疑"
        ];

        // --- 元件：分類選擇器 (優化版) ---
        const CategoryPicker = ({ selectedCategories, onToggle, allCategories, onAddNew, onDelete }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [filterText, setFilterText] = useState('');

            const filtered = useMemo(() => {
                const term = filterText.toLowerCase();
                return allCategories.filter(c => c.toLowerCase().includes(term));
            }, [allCategories, filterText]);

            return (
                <div className="w-full">
                    <div className="flex flex-wrap gap-2 items-center min-h-[40px] p-2 border-b border-wood-200">
                        {selectedCategories.map(cat => (
                            <span key={cat} className="bg-wood-500 text-white text-xs px-2 py-1 rounded-md flex items-center gap-1 shadow-sm tracking-wider">
                                {cat}
                                <X size={12} className="cursor-pointer hover:text-wood-200" onClick={(e) => { e.stopPropagation(); onToggle(cat); }}/>
                            </span>
                        ))}
                        <button 
                            type="button" 
                            onClick={() => setIsOpen(!isOpen)} 
                            className={`text-xs flex items-center gap-1 px-2 py-1 rounded-md transition-colors tracking-wider ${isOpen ? 'bg-wood-200 text-wood-600' : 'text-wood-400 hover:bg-wood-50'}`}
                        >
                            <Plus size={12}/> {isOpen ? '收起' : '選擇分類'}
                        </button>
                    </div>

                    {isOpen && (
                        <div className="mt-2 p-3 bg-white rounded-lg border border-wood-100 shadow-lg animate-fade-in relative z-10">
                            <input 
                                type="text" 
                                placeholder="搜尋或建立..." 
                                value={filterText}
                                onChange={e => setFilterText(e.target.value)}
                                className="w-full mb-3 p-2 bg-wood-50 rounded-md text-sm outline-none focus:ring-1 focus:ring-wood-300 placeholder-wood-300"
                                autoFocus
                            />
                            
                            <div className="flex flex-wrap gap-2 max-h-40 overflow-y-auto no-scrollbar content-start">
                                {filterText && !allCategories.includes(filterText) && (
                                    <button 
                                        type="button" 
                                        onClick={() => { onAddNew(filterText); setFilterText(''); }}
                                        className="bg-wood-600 text-white text-xs px-3 py-1.5 rounded-md hover:bg-wood-700 transition shadow-sm flex items-center gap-1"
                                    >
                                        <Plus size={12}/> 建立「{filterText}」
                                    </button>
                                )}
                                
                                {filtered.map(cat => {
                                    const isSelected = selectedCategories.includes(cat);
                                    if (isSelected) return null; 
                                    return (
                                        <div key={cat} className="group relative">
                                            <button 
                                                type="button" 
                                                onClick={() => onToggle(cat)}
                                                className="bg-wood-50 text-wood-600 border border-wood-100 text-xs px-3 py-1.5 rounded-md hover:bg-wood-100 hover:border-wood-300 transition tracking-wider"
                                            >
                                                {cat}
                                            </button>
                                            <button 
                                                type="button"
                                                onClick={(e) => onDelete(cat, e)}
                                                className="absolute -top-1 -right-1 bg-white text-wood-300 hover:text-dried-500 rounded-full p-0.5 shadow-sm border border-wood-100 opacity-0 group-hover:opacity-100 transition-opacity"
                                                title="刪除分類"
                                            >
                                                <X size={10} strokeWidth={3} />
                                            </button>
                                        </div>
                                    )
                                })}
                                {filtered.length === 0 && !filterText && <span className="text-xs text-wood-300 py-1">無符合分類</span>}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        function ReadingTracker() {
            const [user, setUser] = useState(null);
            const [books, setBooks] = useState([]);
            const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
            const [loading, setLoading] = useState(true);
            const [customId, setCustomId] = useState('');
            const [isLoginMode, setIsLoginMode] = useState(true);
            const [isAuthChecking, setIsAuthChecking] = useState(true);
            const [toast, setToast] = useState(null); 

            // Search & Filter State
            const [searchTerm, setSearchTerm] = useState('');

            const [newBook, setNewBook] = useState({
                title: '', author: '', wordCount: '', isWordCountManual: false,
                addDate: new Date().toISOString().split('T')[0],
                reviewUrl: '', synopsis: '', category: [] 
            });
            const [isSearching, setIsSearching] = useState(false);
            const [activeBookId, setActiveBookId] = useState(null);
            
            // Modal Types: 'finish', 'drop', 'reset', 'delete', 'logout', 'deleteCategory', 'edit'
            const [modalType, setModalType] = useState(null); 
            const [modalData, setModalData] = useState({});
            const [expandedBooks, setExpandedBooks] = useState({});

            useEffect(() => {
                signInAnonymously(auth).catch((error) => console.error("Auth Error", error));
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    if (currentUser) {
                        setUser(currentUser);
                        const savedId = localStorage.getItem('reading_tracker_custom_id');
                        if (savedId) {
                            setCustomId(savedId);
                            setIsLoginMode(false);
                        } else {
                            setIsLoginMode(true);
                        }
                    }
                    setIsAuthChecking(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user || !customId) {
                    setLoading(false);
                    return;
                }
                setLoading(true);
                const collectionRef = collection(db, 'artifacts', appId, 'public', 'data', `reading_list_${customId}`);
                
                const unsubscribe = onSnapshot(collectionRef, (snapshot) => {
                    const fetchedBooks = [];
                    let fetchedCategories = [...DEFAULT_CATEGORIES];

                    snapshot.docs.forEach(doc => {
                        if (doc.id === 'settings') {
                            if (doc.data().categories && Array.isArray(doc.data().categories)) {
                                fetchedCategories = doc.data().categories;
                            }
                        } else {
                            fetchedBooks.push({ id: doc.id, ...doc.data() });
                        }
                    });
                    
                    fetchedBooks.sort((a, b) => {
                        const isReadingA = a.status === 'reading';
                        const isReadingB = b.status === 'reading';
                        if (isReadingA && !isReadingB) return -1;
                        if (!isReadingA && isReadingB) return 1;
                        return new Date(b.addDate) - new Date(a.addDate);
                    });
                    
                    setBooks(fetchedBooks);
                    setCategories(fetchedCategories);
                    setLoading(false);
                }, (error) => {
                    console.error("Error", error);
                    setLoading(false);
                    showToast("資料讀取失敗", "error");
                });
                return () => unsubscribe();
            }, [user, customId]);

            const showToast = (message, type = 'info') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };

            const handleLogin = (e) => {
                e.preventDefault();
                if (customId.trim().length < 3) return showToast("ID 太短囉", "error");
                localStorage.setItem('reading_tracker_custom_id', customId);
                setIsLoginMode(false);
            };

            const handleLogout = () => {
                setModalType('logout');
            };

            const searchBookInfo = async () => {
                if (!newBook.title) return;
                setIsSearching(true);
                try {
                    const q = `intitle:${newBook.title}${newBook.author ? `+inauthor:${newBook.author}` : ''}`;
                    const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${q}&maxResults=1`);
                    const data = await res.json();
                    if (data.items && data.items.length > 0) {
                        const info = data.items[0].volumeInfo;
                        setNewBook(prev => ({
                            ...prev,
                            author: prev.author || info.authors?.[0] || '',
                            wordCount: (info.pageCount || 0) * ESTIMATE_WORDS_PER_PAGE,
                            isWordCountManual: false,
                            synopsis: info.description || ''
                        }));
                        showToast("找到書籍資料！");
                    } else {
                        showToast("找不到書籍資料", "error");
                    }
                } catch (error) {
                    showToast("搜尋失敗", "error");
                } finally {
                    setIsSearching(false);
                }
            };

            const addBook = async (e) => {
                e.preventDefault();
                if (!newBook.title || !customId) return;
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', `reading_list_${customId}`), {
                        ...newBook,
                        status: 'reading',
                        createdAt: serverTimestamp()
                    });
                    setNewBook({
                        title: '', author: '', wordCount: '', isWordCountManual: false,
                        addDate: new Date().toISOString().split('T')[0], reviewUrl: '', synopsis: '', category: []
                    });
                    showToast("新增成功！");
                } catch (error) {
                    showToast("新增失敗", "error");
                }
            };

            const updateCategoriesInDb = async (newCats) => {
                try {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', `reading_list_${customId}`, 'settings'), {
                        categories: newCats
                    }, { merge: true });
                } catch (err) {
                    console.error("Failed to update categories", err);
                    showToast("更新分類失敗", "error");
                }
            };

            const addNewCategory = async (catName) => {
                if (!catName.trim()) return;
                const name = catName.trim();
                if (categories.includes(name)) {
                    showToast("分類已存在", "error");
                    return;
                }
                const updatedCats = [...categories, name];
                await updateCategoriesInDb(updatedCats);
                showToast(`已新增分類「${name}」`);
                return name; 
            };

            const handleDeleteCategory = async (catToDelete, e) => {
                e.stopPropagation();
                setModalData({ category: catToDelete });
                setModalType('deleteCategory');
            };

            // 用於 Add Book 的 toggle
            const toggleNewBookCategory = (cat) => {
                setNewBook(prev => {
                    const currentCats = Array.isArray(prev.category) ? prev.category : [];
                    if (currentCats.includes(cat)) {
                        return { ...prev, category: currentCats.filter(c => c !== cat) };
                    } else {
                        return { ...prev, category: [...currentCats, cat] };
                    }
                });
            };
            
            // 用於 Edit Modal 的 toggle
            const toggleEditBookCategory = (cat) => {
                setModalData(prev => {
                    const currentCats = Array.isArray(prev.category) ? prev.category : [];
                    if (currentCats.includes(cat)) {
                        return { ...prev, category: currentCats.filter(c => c !== cat) };
                    } else {
                        return { ...prev, category: [...currentCats, cat] };
                    }
                });
            };

            // Handle Add New Category from Component
            const handleAddNewCategoryWrapper = async (name, targetStateSetter) => {
                 const newName = await addNewCategory(name);
                 if(newName && targetStateSetter) {
                     // Auto select after add
                     targetStateSetter(prev => ({
                         ...prev,
                         category: [...(prev.category || []), newName]
                     }));
                 }
            };

            const handleModalAction = async () => {
                if (!modalType) return;
                
                try {
                    if (modalType === 'logout') {
                        localStorage.removeItem('reading_tracker_custom_id');
                        setCustomId('');
                        setBooks([]);
                        setIsLoginMode(true);
                        closeModal();
                        return;
                    }
                    
                    if (modalType === 'deleteCategory') {
                        const catToDelete = modalData.category;
                        const updatedCats = categories.filter(c => c !== catToDelete);
                        await updateCategoriesInDb(updatedCats);
                        showToast(`已刪除分類「${catToDelete}」`);
                        closeModal();
                        return;
                    }

                    if (!activeBookId) return;
                    const bookRef = doc(db, 'artifacts', appId, 'public', 'data', `reading_list_${customId}`, activeBookId);

                    if (modalType === 'delete') {
                        await deleteDoc(bookRef);
                        showToast("已刪除書籍");
                    } else if (modalType === 'edit') {
                        await updateDoc(bookRef, {
                            title: modalData.title,
                            author: modalData.author,
                            category: modalData.category,
                            wordCount: modalData.wordCount,
                            addDate: modalData.addDate,
                            reviewUrl: modalData.reviewUrl,
                            synopsis: modalData.synopsis
                        });
                        showToast("書籍資料已更新");
                    } else {
                        const updates = {};
                        if (modalType === 'finish') {
                            updates.status = 'finished';
                            updates.finishDate = modalData.date;
                            updates.rating = modalData.rating;
                            updates.review = modalData.review || '';
                            updates.dropChapter = null;
                            updates.dropDate = null;
                        } else if (modalType === 'drop') {
                            updates.status = 'dropped';
                            updates.dropChapter = modalData.chapter;
                            updates.dropDate = modalData.date;
                            updates.finishDate = null;
                            updates.rating = null;
                        } else if (modalType === 'reset') {
                            updates.status = 'reading';
                            updates.finishDate = null;
                            updates.dropChapter = null;
                            updates.dropDate = null;
                            updates.rating = null;
                            updates.review = null;
                        }
                        await updateDoc(bookRef, updates);
                        showToast("狀態已更新");
                    }
                    closeModal();
                } catch (error) {
                    console.error("Action failed:", error);
                    showToast("操作失敗，請稍後再試", "error");
                }
            };

            const toggleSynopsis = (id) => setExpandedBooks(prev => ({...prev, [id]: !prev[id]}));

            const openModal = (book, type, e) => {
                if (e) e.stopPropagation();
                setActiveBookId(book.id);
                setModalType(type);
                
                if (type === 'edit') {
                    setModalData({
                        title: book.title || '',
                        author: book.author || '',
                        category: book.category || [],
                        wordCount: book.wordCount || '',
                        addDate: book.addDate || '',
                        reviewUrl: book.reviewUrl || '',
                        synopsis: book.synopsis || ''
                    });
                } else {
                    setModalData({ 
                        date: new Date().toISOString().split('T')[0], 
                        chapter: type === 'drop' ? '' : undefined,
                        rating: type === 'finish' ? 0 : undefined,
                        review: type === 'finish' ? (book.review || '') : undefined
                    });
                }
            };

            const closeModal = () => { setActiveBookId(null); setModalType(null); setModalData({}); };

            const activeBook = useMemo(() => {
                return books.find(b => b.id === activeBookId);
            }, [books, activeBookId]);

            const filteredBooks = useMemo(() => {
                if (!searchTerm.trim()) return books;
                const term = searchTerm.toLowerCase();
                return books.filter(b => {
                    return (
                        b.title?.toLowerCase().includes(term) ||
                        b.author?.toLowerCase().includes(term) ||
                        (b.category && b.category.some(c => c.toLowerCase().includes(term)))
                    );
                });
            }, [books, searchTerm]);
            
            const stats = useMemo(() => {
                const yearStats = {};
                let totalFinished = 0, totalDropped = 0, totalReading = 0;
                const activeYears = new Set();
                books.forEach(b => {
                    let y = null;
                    if (b.status === 'reading') {
                        totalReading++;
                    } else if (b.status === 'finished' && b.finishDate) {
                        y = new Date(b.finishDate).getFullYear();
                        totalFinished++;
                    } else if (b.status === 'dropped' && b.dropDate) {
                        y = new Date(b.dropDate).getFullYear();
                        totalDropped++;
                    }
                    if (y) {
                        activeYears.add(y);
                        if (!yearStats[y]) yearStats[y] = { finished: 0, dropped: 0 };
                        if (b.status === 'finished') yearStats[y].finished++;
                        if (b.status === 'dropped') yearStats[y].dropped++;
                    }
                });
                return { 
                    years: Array.from(activeYears).sort((a, b) => b - a), 
                    data: yearStats, 
                    total: { finished: totalFinished, dropped: totalDropped, reading: totalReading } 
                };
            }, [books]);

            const StarRating = ({ rating, setRating, interactive = false }) => {
                return (
                    <div className="flex gap-1">
                        {[1, 2, 3, 4, 5].map((index) => {
                            const filled = rating >= index;
                            const half = rating >= index - 0.5 && !filled;
                            return (
                                <div 
                                    key={index} 
                                    className={`relative ${interactive ? 'cursor-pointer transition-transform active:scale-90' : ''}`}
                                    onClick={(e) => {
                                        if (interactive) {
                                            e.stopPropagation();
                                            const rect = e.currentTarget.getBoundingClientRect();
                                            const width = rect.width;
                                            const clickX = e.clientX - rect.left;
                                            const isLeft = clickX < width / 2;
                                            setRating(isLeft ? index - 0.5 : index);
                                        }
                                    }}
                                >
                                    <Star size={interactive ? 24 : 14} className="text-wood-200" strokeWidth={1.5} />
                                    <div className="absolute top-0 left-0 overflow-hidden" style={{ width: filled ? '100%' : half ? '50%' : '0%' }}>
                                        <Star size={interactive ? 24 : 14} className="fill-gold-400 text-gold-400" strokeWidth={1.5} />
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                );
            };

            if (isAuthChecking) return <div className="min-h-screen flex items-center justify-center bg-paper"><RefreshCw className="animate-spin text-wood-400" /></div>;

            if (isLoginMode) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-paper relative">
                        {toast && (
                            <div className={`fixed top-4 left-1/2 -translate-x-1/2 px-5 py-3 rounded-lg shadow-lg z-50 animate-fade-in-down text-white text-sm tracking-wide flex items-center gap-2 ${toast.type === 'error' ? 'bg-dried-500' : 'bg-wood-500'}`}>
                                {toast.type === 'error' ? <AlertTriangle size={16}/> : <CheckCircle size={16}/>}
                                {toast.message}
                            </div>
                        )}
                        <div className="bg-white p-10 rounded-lg shadow-xl shadow-wood-100/50 border border-wood-100 w-full max-w-md">
                            <div className="flex justify-center mb-8 text-wood-500"><BookOpen size={48} strokeWidth={1} /></div>
                            <h1 className="text-3xl font-bold text-center mb-3 text-ink tracking-[0.2em]">雲端書櫃</h1>
                            <p className="text-sub text-center mb-10 text-sm tracking-widest font-light">輸入專屬 ID，開啟你的閱讀手帳。</p>
                            <form onSubmit={handleLogin} className="space-y-8">
                                <input value={customId} onChange={e=>setCustomId(e.target.value)} placeholder="例如: alex2026" className="w-full p-2 bg-transparent border-b border-wood-200 focus:border-wood-500 outline-none text-center text-lg placeholder-wood-200 transition-colors" />
                                <button type="submit" className="w-full bg-wood-500 text-white py-3 rounded-md hover:bg-wood-600 transition shadow-md shadow-wood-200/50 tracking-[0.2em] text-sm"><LogIn size={18} strokeWidth={1.5} className="inline mr-2 mb-0.5"/> 開啟</button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-paper relative selection:bg-wood-200 selection:text-ink">
                    {toast && (
                        <div className={`fixed top-20 md:top-6 left-1/2 -translate-x-1/2 px-5 py-3 rounded-lg shadow-lg z-50 animate-fade-in-down text-white text-sm tracking-wide flex items-center gap-2 ${toast.type === 'error' ? 'bg-dried-500' : 'bg-wood-500'}`}>
                            {toast.type === 'error' ? <AlertTriangle size={16}/> : <CheckCircle size={16}/>}
                            {toast.message}
                        </div>
                    )}

                    <header className="bg-paper/90 backdrop-blur sticky top-0 z-20 border-b border-wood-100">
                        <div className="max-w-3xl mx-auto px-4 py-5 md:px-6 md:py-6 flex justify-between items-center">
                            <div className="flex items-center gap-3 text-ink font-bold text-xl md:text-2xl tracking-[0.15em] flex-shrink-0">
                                <BookOpen className="text-wood-500" strokeWidth={1.2} />
                                <span>閱讀手帳</span>
                            </div>
                            <div className="flex items-center gap-3 md:gap-4 flex-1 justify-end min-w-0">
                                <div className="text-xs text-wood-400 border border-wood-200 px-3 py-1 rounded-full tracking-wider break-all text-right min-w-0 font-light">
                                    ID: {customId}
                                </div>
                                <button onClick={handleLogout} className="text-wood-400 hover:text-ink transition flex-shrink-0" title="登出"><LogOut size={18} strokeWidth={1.5}/></button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-3xl mx-auto px-4 py-8 md:px-6 md:py-10 space-y-10">
                        {/* 統計區塊 */}
                        <section className="space-y-4">
                            <div className="grid grid-cols-2 gap-4 md:gap-6">
                                <div className="bg-stone-50 p-5 md:p-6 rounded-lg border border-stone-100 flex flex-col justify-between relative overflow-hidden group hover:border-stone-200 transition-colors">
                                    <div className="absolute right-2 top-2 opacity-10"><Hourglass size={48} className="text-stone-400"/></div>
                                    <div className="text-xs md:text-sm text-stone-500 tracking-widest mb-2 font-light">未讀</div>
                                    <div className="text-3xl md:text-4xl font-medium text-stone-600 flex items-baseline gap-2 font-serif">
                                        {stats.total.reading} <span className="text-xs md:text-sm text-stone-400 font-sans font-light">本</span>
                                    </div>
                                </div>
                                <div className="bg-white p-5 md:p-6 rounded-lg border border-wood-100 flex flex-col justify-between relative overflow-hidden group hover:border-wood-200 transition-colors shadow-sm">
                                    <div className="absolute right-2 top-2 opacity-10"><Trophy size={48} className="text-wood-400"/></div>
                                    <div className="text-xs md:text-sm text-wood-500 tracking-widest mb-2 font-light">生涯累積</div>
                                    <div className="text-3xl md:text-4xl font-medium text-ink flex items-baseline gap-2 font-serif">
                                        {stats.total.finished} <span className="text-xs md:text-sm text-sub font-sans font-light">本</span>
                                    </div>
                                    {stats.total.dropped > 0 && <div className="text-[10px] md:text-xs text-dried-500 text-right mt-1 tracking-wider opacity-60">棄書 {stats.total.dropped}</div>}
                                </div>
                            </div>
                            {stats.years.length > 0 && (
                                <div className="grid gap-3 grid-cols-2 md:grid-cols-3">
                                    {stats.years.map(y => (
                                        <div key={y} className="bg-white/60 p-4 rounded-lg border border-wood-50 flex flex-col items-center">
                                            <span className="text-xs md:text-sm font-bold text-wood-400 mb-3 tracking-widest border-b border-wood-100 pb-1">{y}</span>
                                            <div className="flex gap-4 md:gap-6 w-full justify-center items-center">
                                                <div className="text-center group"><div className="text-sage-600 font-medium text-lg md:text-xl font-serif">{stats.data[y].finished}</div><div className="text-[10px] text-wood-300 tracking-wider">完食</div></div>
                                                <div className="h-6 md:h-8 w-[1px] bg-wood-100"></div>
                                                <div className="text-center group"><div className="text-dried-500 font-medium text-lg md:text-xl font-serif">{stats.data[y].dropped}</div><div className="text-[10px] text-wood-300 tracking-wider">棄書</div></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </section>

                        {/* 新增書籍區塊 */}
                        <section className="bg-white rounded-lg p-6 md:p-8 border border-wood-100 shadow-sm relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-1 h-full bg-wood-200"></div>
                            <h2 className="text-lg md:text-xl font-bold mb-6 flex items-center gap-3 text-ink tracking-widest">
                                <span className="text-wood-300">|</span> 紀錄新書
                            </h2>
                            <form onSubmit={addBook} className="grid grid-cols-1 md:grid-cols-12 gap-5 md:gap-6">
                                <div className="md:col-span-5"><input placeholder="書名" value={newBook.title} onChange={e=>setNewBook({...newBook, title:e.target.value})} className="w-full p-2 bg-transparent border-b border-wood-200 focus:border-wood-400 outline-none placeholder-wood-300 transition-colors rounded-none tracking-wide text-ink" required /></div>
                                <div className="md:col-span-4"><input placeholder="作者" value={newBook.author} onChange={e=>setNewBook({...newBook, author:e.target.value})} className="w-full p-2 bg-transparent border-b border-wood-200 focus:border-wood-400 outline-none placeholder-wood-300 transition-colors rounded-none tracking-wide text-ink" /></div>
                                <div className="md:col-span-3"><button type="button" onClick={searchBookInfo} disabled={isSearching || !newBook.title} className="w-full h-full text-wood-600 bg-wood-50 hover:bg-wood-100 rounded-md transition flex items-center justify-center gap-2 text-sm disabled:opacity-50 py-3 md:py-2 tracking-widest font-light">{isSearching ? <RefreshCw className="animate-spin w-4 h-4" /> : <Search className="w-4 h-4" strokeWidth={1} />} 搜尋</button></div>
                                
                                <div className="md:col-span-12 relative">
                                    <CategoryPicker 
                                        selectedCategories={newBook.category} 
                                        onToggle={toggleNewBookCategory} 
                                        allCategories={categories}
                                        onAddNew={(name) => handleAddNewCategoryWrapper(name, setNewBook)}
                                        onDelete={handleDeleteCategory}
                                    />
                                </div>

                                <div className="md:col-span-4 grid grid-cols-2 gap-2 md:block">
                                    <div className="relative col-span-2 md:col-span-1"><input type="number" placeholder="字數/頁數" value={newBook.wordCount} onChange={e=>setNewBook({...newBook, wordCount:e.target.value, isWordCountManual:true})} className="w-full p-2 bg-transparent border-b border-wood-200 focus:border-wood-400 outline-none placeholder-wood-300 transition-colors rounded-none tracking-wide" />{!newBook.isWordCountManual && newBook.wordCount && <span className="absolute right-0 top-2 text-[10px] text-wood-400 px-1 rounded font-light">估算</span>}</div>
                                </div>
                                <div className="md:col-span-4"><input type="date" value={newBook.addDate} onChange={e=>setNewBook({...newBook, addDate:e.target.value})} className="w-full p-2 bg-transparent border-b border-wood-200 text-sub focus:border-wood-400 outline-none rounded-none tracking-wide font-sans" /></div>
                                <div className="md:col-span-4"><input type="url" placeholder="推薦網址" value={newBook.reviewUrl} onChange={e=>setNewBook({...newBook, reviewUrl:e.target.value})} className="w-full p-2 bg-transparent border-b border-wood-200 focus:border-wood-400 outline-none placeholder-wood-300 transition-colors rounded-none tracking-wide" /></div>
                                <div className="md:col-span-12"><textarea placeholder="故事大綱..." value={newBook.synopsis} onChange={e=>setNewBook({...newBook, synopsis:e.target.value})} className="w-full p-4 bg-wood-50/30 rounded-lg border border-wood-100 focus:border-wood-300 outline-none h-24 placeholder-wood-300 resize-none text-base tracking-wide leading-7" /></div>
                                <div className="md:col-span-12 flex justify-end"><button type="submit" className="w-full md:w-auto bg-wood-500 text-white px-8 py-3 md:py-2 rounded-md hover:bg-wood-600 transition shadow-sm tracking-[0.2em] flex items-center justify-center gap-2 text-sm font-light"><Plus size={16} /> 加入書櫃</button></div>
                            </form>
                        </section>

                        {/* 書單列表區塊 */}
                        <section className="space-y-6">
                            <div className="flex flex-col md:flex-row md:items-center gap-4 mb-4 px-1">
                                <h2 className="text-lg md:text-xl font-bold tracking-widest text-ink whitespace-nowrap flex items-center gap-2">
                                    <span className="w-1.5 h-1.5 rounded-full bg-wood-400 inline-block"></span>
                                    書單列表
                                </h2>
                                {loading && <RefreshCw className="animate-spin text-wood-300 w-4 h-4" />}
                                
                                <div className="flex-1 w-full md:w-auto flex items-center gap-2 bg-white px-3 py-2 rounded-md border border-wood-100 focus-within:border-wood-300 transition-all shadow-sm">
                                    <Filter size={14} className="text-wood-300" />
                                    <input 
                                        type="text" 
                                        placeholder="搜尋書名、作者或分類..." 
                                        value={searchTerm}
                                        onChange={e => setSearchTerm(e.target.value)}
                                        className="bg-transparent border-none outline-none w-full text-sm text-ink placeholder-wood-200 tracking-wide"
                                    />
                                    {searchTerm && <button onClick={() => setSearchTerm('')}><X size={14} className="text-wood-300 hover:text-wood-500"/></button>}
                                </div>
                            </div>
                            
                            {!loading && filteredBooks.length === 0 && (
                                <div className="text-center py-16 text-wood-300 bg-white rounded-lg border border-dashed border-wood-200">
                                    <BookOpen className="mx-auto mb-3 opacity-30 w-10 h-10" strokeWidth={1} />
                                    <p className="tracking-widest font-light text-sm">
                                        {books.length === 0 ? "書櫃還是空的，選一本書開始吧。" : "找不到符合的書籍。"}
                                    </p>
                                </div>
                            )}

                            <div className="grid grid-cols-1 gap-6">
                                {filteredBooks.map(book => (
                                    <div key={book.id} className="group bg-white p-6 rounded-lg border border-wood-50 hover:border-wood-200 transition-all duration-500 animate-fade-in shadow-sm flex flex-col md:flex-row gap-6 relative overflow-hidden">
                                        <div className={`absolute left-0 top-0 bottom-0 w-1 ${book.status==='finished'?'bg-sage-200': book.status==='dropped'?'bg-dried-200': 'bg-wood-200'}`}></div>

                                        <div className="flex-1 pl-2 md:pl-0">
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <div className="flex flex-wrap gap-2 items-center mb-2">
                                                        {book.category && (Array.isArray(book.category) ? book.category : [book.category]).map((cat, idx) => (
                                                            <span key={idx} className="text-[10px] text-wood-500 border border-wood-100 px-2 py-0.5 rounded-sm tracking-wider">{cat}</span>
                                                        ))}
                                                        <span className={`px-2 py-0.5 rounded-sm text-[10px] tracking-widest whitespace-nowrap ${book.status==='finished'?'bg-sage-50 text-sage-600': book.status==='dropped'?'bg-dried-50 text-dried-600': 'bg-stone-50 text-stone-500'}`}>{book.status==='finished'?'完食':book.status==='dropped'?'棄書':'未讀'}</span>
                                                    </div>
                                                    <h3 className="font-bold text-xl md:text-2xl text-ink tracking-widest leading-relaxed mb-1 font-serif">{book.title}</h3>
                                                </div>
                                                {book.status === 'finished' && book.rating > 0 && <div className="flex gap-0.5 pt-1"><StarRating rating={book.rating} /></div>}
                                            </div>
                                            
                                            <div className="text-sm text-sub space-y-3">
                                                <div className="flex flex-wrap gap-4 text-xs text-wood-400 font-light tracking-wider border-b border-wood-50 pb-3 mb-3 border-dashed">
                                                    <span className="flex items-center gap-1.5"><User size={12}/> {book.author||'佚名'}</span>
                                                    <span className="flex items-center gap-1.5"><TrendingUp size={12}/> {book.wordCount ? `${Number(book.wordCount).toLocaleString()}字` : '未知'}</span>
                                                    <span className="flex items-center gap-1.5"><Calendar size={12}/> {book.addDate}</span>
                                                </div>
                                                {book.status === 'finished' && (
                                                    <div className="mt-2 text-sage-600">
                                                        <p className="flex items-center gap-2 text-xs md:text-sm tracking-wide"><CheckCircle size={14} strokeWidth={1.5}/> <span className="font-light">完食於 {book.finishDate}</span></p>
                                                        {book.review && (
                                                            <p className="text-sage-text text-sm mt-2 pl-4 border-l border-sage-200 ml-1 leading-7 font-serif italic opacity-90">{book.review}</p>
                                                        )}
                                                    </div>
                                                )}
                                                {book.status === 'dropped' && <div className="text-dried-text mt-2 text-xs md:text-sm tracking-wide"><p className="flex items-center gap-2"><BookX size={14} strokeWidth={1.5}/> <span>閱讀到第 {book.dropChapter} 章</span></p>{book.dropDate && <p className="text-xs opacity-60 mt-1 ml-6 font-light">棄書日: {book.dropDate}</p>}</div>}
                                                {book.reviewUrl && <div className="mt-2"><a href={book.reviewUrl} target="_blank" className="inline-flex items-center gap-1 text-wood-500 hover:text-wood-700 hover:underline decoration-1 underline-offset-4 transition text-xs tracking-wider"><LinkIcon size={12}/> 推薦閱讀</a></div>}
                                                {book.synopsis && <div className="mt-3"><button onClick={()=>toggleSynopsis(book.id)} className="flex items-center gap-1 text-xs text-wood-400 hover:text-wood-600 transition tracking-wider mb-2"><FileText size={12}/> {expandedBooks[book.id] ? '收起大綱' : '故事大綱'}</button>{expandedBooks[book.id] && <p className="text-xs text-sub leading-7 bg-paper p-4 rounded-md border border-wood-50 whitespace-pre-wrap font-serif text-justify">{book.synopsis}</p>}</div>}
                                            </div>
                                        </div>

                                        <div className="flex flex-row md:flex-col gap-2 mt-2 pt-3 border-t border-wood-50 md:mt-0 md:pt-0 md:border-t-0 md:border-l md:border-dashed md:pl-6 md:w-32 shrink-0 md:justify-center">
                                            {book.status === 'reading' ? (
                                                <>
                                                    <button onClick={(e)=>openModal(book, 'finish', e)} className="flex-1 md:w-full py-2 px-3 bg-white text-sage-600 hover:bg-sage-50 rounded-md text-xs transition flex items-center justify-center gap-1.5 border border-wood-100 hover:border-sage-200 tracking-wider">
                                                        <CheckCircle size={14} strokeWidth={1.5} /> 完食
                                                    </button>
                                                    <button onClick={(e)=>openModal(book, 'drop', e)} className="flex-1 md:w-full py-2 px-3 bg-white text-dried-600 hover:bg-dried-50 rounded-md text-xs transition flex items-center justify-center gap-1.5 border border-wood-100 hover:border-dried-200 tracking-wider">
                                                        <BookX size={14} strokeWidth={1.5} /> 棄書
                                                    </button>
                                                </>
                                            ) : (
                                                <button onClick={(e)=>openModal(book, 'reset', e)} className="flex-1 md:w-full py-2 px-3 bg-white text-stone-500 hover:bg-stone-50 rounded-md text-xs transition flex items-center justify-center gap-1.5 border border-wood-100 hover:border-stone-200 tracking-wider">
                                                    <RotateCcw size={14} strokeWidth={1.5} /> 重設
                                                </button>
                                            )}
                                            
                                            <div className="hidden md:block w-full h-px bg-wood-100 my-1 border-b border-dashed"></div>

                                            <div className="flex gap-2 flex-1 md:w-full">
                                                <button onClick={(e)=>openModal(book, 'edit', e)} className="flex-1 py-2 bg-white text-wood-300 hover:text-wood-500 rounded-md transition flex items-center justify-center border border-transparent hover:border-wood-100" title="編輯">
                                                    <Edit3 size={16} strokeWidth={1.2} />
                                                </button>
                                                <button onClick={(e)=>openModal(book, 'delete', e)} className="flex-1 py-2 bg-white text-wood-300 hover:text-dried-500 rounded-md transition flex items-center justify-center border border-transparent hover:border-dried-100" title="刪除">
                                                    <Trash2 size={16} strokeWidth={1.2} />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>

                        {/* 通用 Modal */}
                        {(activeBookId || modalType === 'logout' || modalType === 'deleteCategory') && (
                            <div className="fixed inset-0 bg-ink/10 backdrop-blur-[2px] flex items-end md:items-center justify-center z-50 animate-fade-in p-0 md:p-4" onClick={closeModal}>
                                <div className="bg-paper rounded-t-2xl md:rounded-lg w-full max-w-sm p-8 shadow-xl border border-wood-100 pb-10 md:pb-8 animate-modal-in max-h-[90vh] overflow-y-auto no-scrollbar relative" onClick={e => e.stopPropagation()}>
                                    <div className="w-12 h-1 bg-wood-200 rounded-full mx-auto mb-8 md:hidden flex-shrink-0"></div>
                                    
                                    <h3 className="text-xl font-bold mb-6 text-center text-ink tracking-[0.2em] border-b border-wood-100 pb-4 font-serif">
                                        {modalType === 'finish' && '完食紀錄'}
                                        {modalType === 'drop' && '棄書紀錄'}
                                        {modalType === 'reset' && '重設狀態'}
                                        {modalType === 'delete' && '刪除書籍'}
                                        {modalType === 'logout' && '登出確認'}
                                        {modalType === 'deleteCategory' && '刪除分類'}
                                        {modalType === 'edit' && '編輯資料'}
                                    </h3>

                                    <div className="mb-8">
                                        {modalType === 'edit' && (
                                            <div className="space-y-5">
                                                <input placeholder="書名" value={modalData.title} onChange={e=>setModalData({...modalData, title:e.target.value})} className="w-full p-2 bg-transparent border-b border-wood-200 outline-none font-serif text-lg tracking-wide placeholder-wood-200" />
                                                <input placeholder="作者" value={modalData.author} onChange={e=>setModalData({...modalData, author:e.target.value})} className="w-full p-2 bg-transparent border-b border-wood-200 outline-none tracking-wide placeholder-wood-200" />
                                                
                                                <CategoryPicker 
                                                    selectedCategories={modalData.category} 
                                                    onToggle={toggleEditBookCategory} 
                                                    allCategories={categories}
                                                    onAddNew={(name) => handleAddNewCategoryWrapper(name, setModalData)}
                                                    onDelete={handleDeleteCategory}
                                                />

                                                <div className="flex gap-4">
                                                    <input type="number" placeholder="字數" value={modalData.wordCount} onChange={e=>setModalData({...modalData, wordCount:e.target.value})} className="w-1/2 p-2 bg-transparent border-b border-wood-200 outline-none font-light" />
                                                    <input type="date" value={modalData.addDate} onChange={e=>setModalData({...modalData, addDate:e.target.value})} className="w-1/2 p-2 bg-transparent border-b border-wood-200 outline-none font-light" />
                                                </div>
                                                <input placeholder="推薦網址" value={modalData.reviewUrl} onChange={e=>setModalData({...modalData, reviewUrl:e.target.value})} className="w-full p-2 bg-transparent border-b border-wood-200 outline-none placeholder-wood-200" />
                                                <textarea placeholder="大綱" value={modalData.synopsis} onChange={e=>setModalData({...modalData, synopsis:e.target.value})} className="w-full p-3 bg-wood-50 rounded-md outline-none h-24 resize-none border border-wood-100 text-sm leading-6" />
                                            </div>
                                        )}
                                        {modalType === 'finish' && (
                                            <div className="bg-wood-50 p-6 rounded-lg space-y-6">
                                                <div className="text-center">
                                                    <label className="text-xs text-wood-400 mb-2 block tracking-widest">完食日期</label>
                                                    <input type="date" value={modalData.date} onChange={e=>setModalData({...modalData, date:e.target.value})} className="w-full bg-transparent border-b border-wood-200 focus:border-wood-400 outline-none p-2 text-center text-ink font-serif text-lg" />
                                                </div>
                                                <div className="flex flex-col items-center gap-3 py-2 border-t border-b border-wood-100 border-dashed">
                                                    <label className="text-xs text-wood-400 tracking-widest">評分</label>
                                                    <StarRating rating={modalData.rating} setRating={(r) => setModalData({...modalData, rating: r})} interactive={true} />
                                                    <div className="text-xs text-gold-500 font-serif h-4">{modalData.rating > 0 ? `${modalData.rating} 星` : ''}</div>
                                                </div>
                                                <div className="space-y-2">
                                                    <label className="text-xs text-wood-400 flex items-center gap-1 tracking-widest"><MessageSquare size={12}/> 心得短評</label>
                                                    <textarea 
                                                        placeholder="寫點什麼..." 
                                                        value={modalData.review} 
                                                        onChange={e=>setModalData({...modalData, review:e.target.value})} 
                                                        className="w-full p-3 bg-white rounded-md border border-wood-100 focus:border-wood-300 outline-none h-24 placeholder-wood-200 resize-none text-sm text-ink leading-7 font-serif"
                                                    />
                                                </div>
                                            </div>
                                        )}
                                        {modalType === 'drop' && (
                                            <div className="bg-wood-50 p-6 rounded-lg space-y-6">
                                                <div className="space-y-2"><label className="text-xs text-wood-400 block tracking-widest">棄書日期</label><input type="date" value={modalData.date} onChange={e=>setModalData({...modalData, date:e.target.value})} className="w-full bg-transparent border-b border-wood-200 focus:border-wood-400 outline-none p-2 text-center text-ink font-serif" /></div>
                                                <div className="space-y-2"><label className="text-xs text-wood-400 block tracking-widest">停止點</label><input placeholder="例如：第三章" value={modalData.chapter} onChange={e=>setModalData({...modalData, chapter:e.target.value})} className="w-full bg-transparent border-b border-wood-200 focus:border-wood-400 outline-none p-2 text-center text-ink placeholder-wood-200 rounded-none tracking-wide" /></div>
                                            </div>
                                        )}
                                        {modalType === 'reset' && (
                                            <div className="text-center p-4 text-wood-500">
                                                <RotateCcw size={32} className="mx-auto mb-4 text-wood-200" strokeWidth={1} />
                                                <p className="mb-2 font-bold text-ink font-serif">{activeBook?.title}</p>
                                                <p className="text-sm font-light tracking-wide">將重設為「未讀」狀態，<br/>並清除所有心得紀錄。</p>
                                            </div>
                                        )}
                                        {modalType === 'delete' && (
                                            <div className="text-center p-4 text-wood-500">
                                                <AlertTriangle size={32} className="mx-auto mb-4 text-dried-300" strokeWidth={1} />
                                                <p className="mb-2 font-bold text-ink font-serif">{activeBook?.title}</p>
                                                <p className="text-sm text-dried-500 tracking-wide">確定要刪除嗎？<br/>此動作無法復原。</p>
                                            </div>
                                        )}
                                        {modalType === 'logout' && (
                                            <div className="text-center p-4 text-wood-500">
                                                <LogOut size={32} className="mx-auto mb-4 text-wood-200" strokeWidth={1} />
                                                <p className="text-sm tracking-wide leading-6">確定要登出嗎？<br/><span className="text-xs text-wood-300">下次需重新輸入 ID。</span></p>
                                            </div>
                                        )}
                                        {modalType === 'deleteCategory' && (
                                            <div className="text-center p-4 text-wood-500">
                                                <Trash2 size={32} className="mx-auto mb-4 text-dried-300" strokeWidth={1} />
                                                <p className="mb-2 font-bold text-ink tracking-widest">{modalData.category}</p>
                                                <p className="text-sm text-dried-500 tracking-wide">確定要刪除此分類嗎？</p>
                                            </div>
                                        )}
                                    </div>

                                    <div className="flex gap-4">
                                        <button onClick={closeModal} className="flex-1 py-2 text-wood-400 hover:bg-wood-50 rounded-md transition tracking-[0.2em] text-sm border border-transparent hover:border-wood-100">取消</button>
                                        <button onClick={handleModalAction} className={`flex-1 py-2 text-white rounded-md shadow-sm transition tracking-[0.2em] text-sm font-light
                                            ${['finish', 'edit'].includes(modalType)?'bg-sage-500 hover:bg-sage-600':
                                            ['reset', 'logout'].includes(modalType)?'bg-wood-400 hover:bg-wood-500':
                                            'bg-dried-500 hover:bg-dried-600'}`}>
                                            確認
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<ReadingTracker />);
    </script>
</body>
</html>