<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旅遊費用分算 - 雲端版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>

    <style>
        html { font-size: 90%; }
        body {
            font-family: "Microsoft JhengHei", "微軟正黑體", sans-serif;
            background-color: #f9f7f2;
            color: #4a4a4a;
            -webkit-font-smoothing: antialiased;
            letter-spacing: 0.03em;
            font-weight: 700 !important;
            line-height: 1.4;
        }
        @media (max-width: 640px) { html { font-size: 108%; } }
        *, *::before, *::after { font-weight: 700 !important; font-style: normal !important; }
        input, select, button { font-family: "Microsoft JhengHei", "微軟正黑體", sans-serif !important; }
        input:focus, select:focus {
            outline: none;
            border-color: #5c6b53 !important;
            box-shadow: 0 0 0 4px rgba(92, 107, 83, 0.08);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5c6b53;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .scale-up-center {
            animation: scale-up-center 0.2s cubic-bezier(0.390, 0.575, 0.565, 1.000) both;
        }
        @keyframes scale-up-center {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const firebaseConfig = {
            apiKey: "AIzaSyDXPngTQ57pSYkct6omI0BEvUIlN-uMqys",
            authDomain: "travelledger-fa981.firebaseapp.com",
            projectId: "travelledger-fa981",
            storageBucket: "travelledger-fa981.firebasestorage.app",
            messagingSenderId: "575807326202",
            appId: "1:575807326202:web:c69bff9eef548b5d0bc643",
            measurementId: "G-T6NKH0R274"
        };

        if (!firebase.apps.length) {
            try {
                firebase.initializeApp(firebaseConfig);
            } catch (e) {
                console.error("Firebase 初始化失敗", e);
            }
        }
        const db = firebase.firestore();

        const { useState, useEffect, useMemo } = React;
        
        const Icon = ({ name, className = "w-5 h-5" }) => {
            return <i data-lucide={name} className={className}></i>;
        };

        const CURRENCIES = [
            { code: 'TWD', name: '台幣', symbol: 'TWD' },
            { code: 'USD', name: '美金', symbol: 'USD' },
            { code: 'JPY', name: '日圓', symbol: '¥' },
            { code: 'KRW', name: '韓元', symbol: '₩' },
            { code: 'CNY', name: '人民幣', symbol: 'CNY' },
            { code: 'EUR', name: '歐元', symbol: 'EUR' },
            { code: 'HKD', name: '港幣', symbol: 'HKD' },
            { code: 'GBP', name: '英鎊', symbol: 'GBP' },
            { code: 'AUD', name: '澳幣', symbol: 'AUD' },
            { code: 'SGD', name: '新加坡幣', symbol: 'SGD' },
            { code: 'THB', name: '泰銖', symbol: 'THB' },
        ];

        const LoginScreen = ({ onJoin }) => {
            const [tripId, setTripId] = useState('');
            const [history, setHistory] = useState([]);
            useEffect(() => {
                const stored = localStorage.getItem('trip_history');
                if (stored) { try { setHistory(JSON.parse(stored)); } catch (e) {} }
            }, []);
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            const handleJoin = (idToJoin) => {
                const targetId = idToJoin || tripId;
                if (!targetId) return;
                const newHistory = [targetId, ...history.filter(h => h !== targetId)].slice(0, 5);
                setHistory(newHistory);
                localStorage.setItem('trip_history', JSON.stringify(newHistory));
                onJoin(targetId);
            };
            return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-[#f9f7f2]">
                    <div className="bg-white p-6 rounded-[2rem] shadow-xl max-w-sm w-full border border-[#e5e1d8] space-y-4 text-center">
                        <div className="bg-[#5c6b53]/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-2 text-[#5c6b53]"><Icon name="cloud" className="w-8 h-8" /></div>
                        <h1 className="text-xl font-black text-[#5c6b53]">輸入旅遊群組代碼</h1>
                        <p className="text-[#a8a297] text-sm">輸入相同代碼的夥伴，資料將即時同步。</p>
                        <input type="text" value={tripId} onChange={e => setTripId(e.target.value)} onKeyDown={e => e.key === 'Enter' && tripId && handleJoin()} placeholder="例如：Tokyo2026" className="w-full px-4 py-3 bg-[#fdfaf5] border border-[#e5e1d8] rounded-xl text-center text-lg font-black uppercase tracking-widest placeholder:normal-case placeholder:tracking-normal" />
                        <button onClick={() => handleJoin()} className="w-full bg-[#5c6b53] text-white py-3 rounded-xl text-lg shadow-lg font-black active:scale-95 transition-all">進入記帳</button>
                        {history.length > 0 && (
                            <div className="pt-4 border-t border-[#e5e1d8]/50 mt-2">
                                <p className="text-xs text-[#a8a297] mb-3 font-bold tracking-widest">歷史紀錄</p>
                                <div className="flex flex-wrap gap-2 justify-center">
                                    {history.map(h => (
                                        <div key={h} className="inline-flex items-center bg-[#f3f0e9] rounded-lg border border-[#e5e1d8] overflow-hidden shadow-sm">
                                            <span onClick={() => handleJoin(h)} className="px-3 py-2 text-[#5c6b53] text-xs font-black cursor-pointer hover:bg-[#e5e1d8] transition-colors border-r border-[#e5e1d8]/60">{h}</span>
                                            <button onClick={(e) => { e.stopPropagation(); const n = history.filter(x => x !== h); setHistory(n); localStorage.setItem('trip_history', JSON.stringify(n)); }} className="px-2 py-2 text-[#a8a297] hover:text-red-500 hover:bg-[#e5e1d8] transition-colors flex items-center justify-center outline-none">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        function App() {
            const [tripId, setTripId] = useState(localStorage.getItem('my_trip_id') || null);
            const [loading, setLoading] = useState(false);
            const [members, setMembers] = useState([]); // [{name: 'A', bankInfo: ''}, ...]
            const [expenses, setExpenses] = useState([]);
            const [rates, setRates] = useState({ TWD: 1 });
            
            const [newMemberName, setNewMemberName] = useState('');
            const [loadingRates, setLoadingRates] = useState(false);
            const [showClearConfirm, setShowClearConfirm] = useState(false);
            const [deleteTargetId, setDeleteTargetId] = useState(null);
            const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);
            const [editingBank, setEditingBank] = useState(null); // {name, info}
            const [toast, setToast] = useState(null);
            const [form, setForm] = useState({ item: '', amount: '', currency: 'TWD', payer: '', participants: [] });

            useEffect(() => {
                if (!tripId) return;
                setLoading(true);
                const unsubscribe = db.collection('trips').doc(tripId).onSnapshot((doc) => {
                    setLoading(false);
                    if (doc.exists) {
                        const data = doc.data();
                        // 相容舊資料格式 (如果是純字串陣列，轉為物件陣列)
                        const formattedMembers = (data.members || []).map(m => typeof m === 'string' ? { name: m, bankInfo: '' } : m);
                        setMembers(formattedMembers);
                        setExpenses(data.expenses || []);
                    } else {
                        db.collection('trips').doc(tripId).set({ members: [], expenses: [], createdAt: new Date() });
                    }
                }, () => { setLoading(false); showToast("同步失敗"); });
                localStorage.setItem('my_trip_id', tripId);
                fetchRates();
                return () => unsubscribe();
            }, [tripId]);

            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });

            const showToast = (msg) => { setToast(msg); setTimeout(() => setToast(null), 3000); };
            const fetchRates = async () => {
                setLoadingRates(true);
                try {
                    const res = await fetch(`https://open.er-api.com/v6/latest/TWD`);
                    const data = await res.json();
                    if (data && data.rates) {
                        const newRates = { TWD: 1 };
                        CURRENCIES.forEach(curr => {
                            if (curr.code !== 'TWD' && data.rates[curr.code]) newRates[curr.code] = (1 / data.rates[curr.code] * 1.02).toFixed(4);
                        });
                        setRates(newRates);
                    }
                } finally { setLoadingRates(false); }
            };

            const updateCloud = (newData) => { db.collection('trips').doc(tripId).update(newData).catch(() => showToast("雲端更新失敗")); };

            const addMember = () => {
                const trimmed = newMemberName.trim();
                if (!trimmed || members.some(m => m.name === trimmed)) return;
                const newMembers = [...members, { name: trimmed, bankInfo: '' }];
                setMembers(newMembers); updateCloud({ members: newMembers }); setNewMemberName('');
            };

            const removeMember = (name) => {
                const newMembers = members.filter(m => m.name !== name);
                if (form.payer === name) setForm({ ...form, payer: '' });
                setForm(prev => ({ ...prev, participants: prev.participants.filter(p => p !== name) }));
                updateCloud({ members: newMembers });
            };

            const saveBankInfo = () => {
                const newMembers = members.map(m => m.name === editingBank.name ? { ...m, bankInfo: editingBank.info } : m);
                setMembers(newMembers); updateCloud({ members: newMembers }); setEditingBank(null); showToast("帳戶資訊已儲存");
            };

            const submitExpense = () => {
                const { item, amount, currency, payer, participants } = form;
                if (!item || !amount || !payer || participants.length === 0) return;
                const totalAmount = parseFloat(amount);
                const count = participants.length;
                const baseSplit = Math.round(totalAmount / count);
                const lastSplit = totalAmount - (baseSplit * (count - 1));
                const splits = {};
                participants.forEach((name, index) => { splits[name] = index === count - 1 ? lastSplit : baseSplit; });
                const newExpense = {
                    id: Date.now(), item, amount: totalAmount, currency, rate: parseFloat(rates[currency] || 1),
                    payer, splits, timestamp: new Date().toLocaleString('zh-TW', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })
                };
                updateCloud({ expenses: [...expenses, newExpense] });
                setForm({ ...form, item: '', amount: '', participants: [] }); showToast("支出已同步");
            };

            const settlement = useMemo(() => {
                const balances = {}; 
                members.forEach(m => balances[m.name] = 0);
                expenses.forEach(exp => {
                    const amountTWD = exp.amount * exp.rate;
                    if (balances[exp.payer] !== undefined) balances[exp.payer] += amountTWD;
                    Object.entries(exp.splits).forEach(([name, splitAmt]) => { if (balances[name] !== undefined) balances[name] -= (splitAmt * exp.rate); });
                });
                const td = [], tc = [];
                Object.entries(balances).forEach(([name, bal]) => {
                    if (bal < -1) td.push({ name, amount: Math.abs(bal) });
                    else if (bal > 1) tc.push({ name, amount: bal });
                });
                const transactions = [];
                let dIdx = 0, cIdx = 0;
                while (dIdx < td.length && cIdx < tc.length) {
                    const amt = Math.min(td[dIdx].amount, tc[cIdx].amount);
                    if (amt > 0) transactions.push({ from: td[dIdx].name, to: tc[cIdx].name, amount: amt });
                    td[dIdx].amount -= amt; tc[cIdx].amount -= amt;
                    if (td[dIdx].amount <= 0.1) dIdx++; if (tc[cIdx].amount <= 0.1) cIdx++;
                }
                const totalTWD = expenses.reduce((sum, e) => sum + (e.amount * e.rate), 0);
                return { totalTWD, transactions };
            }, [expenses, members, rates]);

            const copyToClipboard = () => {
                let text = `【${tripId} 結算清單】\n`;
                text += `總支出：TWD ${Math.round(settlement.totalTWD)}\n━━━━\n`;
                settlement.transactions.forEach(t => {
                    const receiver = members.find(m => m.name === t.to);
                    text += `◆ ${t.from} → ${t.to}：TWD ${Math.round(t.amount)}\n`;
                    if (receiver && receiver.bankInfo) text += `   (帳戶: ${receiver.bankInfo})\n`;
                });
                const el = document.createElement('textarea'); el.value = text; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
                showToast("已複製結算清單");
            };

            if (!tripId) return <LoginScreen onJoin={setTripId} />;
            if (loading && members.length === 0) return <div className="min-h-screen flex items-center justify-center bg-[#f9f7f2] flex-col gap-4"><div className="loader"></div><p className="text-[#5c6b53] tracking-widest text-xs uppercase">Syncing...</p></div>;

            return (
                <div className="min-h-screen pb-20 font-bold">
                    <header className="bg-white/90 backdrop-blur-md border-b border-[#e5e1d8] p-3 sticky top-0 z-40 flex justify-between items-center shadow-sm">
                        <div><h1 className="text-xl sm:text-2xl flex items-center gap-2 text-[#5c6b53] font-bold"><Icon name="cloud-lightning" className="w-6 h-6" /> {tripId}</h1><p className="text-[10px] text-[#a8a297] mt-1 tracking-[0.3em] uppercase">Cloud Sync Active</p></div>
                        <div className="flex gap-2">
                            <button onClick={fetchRates} className={`p-2 rounded-full text-[#a8a297] ${loadingRates ? 'animate-spin' : ''}`}><Icon name="refresh-cw" /></button>
                            <button onClick={() => setShowLogoutConfirm(true)} className="p-2 rounded-full text-[#a8a297] hover:text-red-500"><Icon name="log-out" /></button>
                        </div>
                    </header>

                    <main className="max-w-xl mx-auto p-4 space-y-5">
                        <section className="bg-white rounded-2xl border border-[#e5e1d8] p-4 sm:p-5 shadow-sm">
                            <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-[#8d775f]"><Icon name="users" /> 同行夥伴</h2>
                            <div className="flex gap-2 mb-4">
                                <input type="text" value={newMemberName} onChange={e => setNewMemberName(e.target.value)} onKeyPress={e => e.key === 'Enter' && addMember()} placeholder="輸入夥伴姓名..." className="flex-1 px-4 py-2.5 bg-[#fdfaf5] border border-[#e5e1d8] rounded-xl outline-none" />
                                <button onClick={addMember} className="bg-[#5c6b53] text-white px-5 rounded-xl shadow-md"><Icon name="user-plus" /></button>
                            </div>
                            <div className="flex flex-wrap gap-3">
                                {members.map(m => (
                                    <div key={m.name} className="flex flex-col gap-1">
                                        <span className="bg-[#f3f0e9] text-[#5c6b53] px-4 py-2 rounded-lg flex items-center gap-3 text-sm font-black border border-[#e5e1d8]/50">
                                            {m.name} 
                                            <button onClick={() => removeMember(m.name)} className="text-[#a8a297] hover:text-red-500"><Icon name="x" className="w-4 h-4" /></button>
                                        </span>
                                        <button onClick={() => setEditingBank({ name: m.name, info: m.bankInfo })} className="text-[10px] text-left px-2 text-[#a8a297] hover:text-[#5c6b53] flex items-center gap-1">
                                            <Icon name="credit-card" className="w-3 h-3" /> {m.bankInfo ? '修改帳戶' : '設定帳戶'}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </section>

                        <section className="bg-white rounded-2xl border border-[#e5e1d8] p-4 sm:p-5 shadow-sm space-y-4">
                            <h2 className="text-lg font-bold flex items-center gap-2 text-[#8d775f]"><Icon name="coffee" /> 紀錄一筆支出</h2>
                            <input type="text" value={form.item} onChange={e => setForm({...form, item: e.target.value})} placeholder="例如：晚餐、門票..." className="w-full px-4 py-2.5 bg-[#fdfaf5] border border-[#e5e1d8] rounded-xl outline-none" />
                            <div className="flex gap-3">
                                <select value={form.currency} onChange={e => setForm({...form, currency: e.target.value})} className="w-[40%] px-3 py-2 bg-[#fdfaf5] border border-[#e5e1d8] rounded-xl outline-none">
                                    {CURRENCIES.map(c => <option key={c.code} value={c.code}>{c.name}</option>)}
                                </select>
                                <div className="relative flex-1">
                                    <span className="absolute left-4 top-2.5 text-[#a8a297]">{CURRENCIES.find(c => c.code === form.currency)?.symbol}</span>
                                    <input type="text" value={form.amount} onChange={e => /^\d*\.?\d*$/.test(e.target.value) && setForm({...form, amount: e.target.value})} placeholder="0" className="w-full pl-14 pr-4 py-2.5 bg-[#fdfaf5] border border-[#e5e1d8] rounded-xl text-xl font-black text-right outline-none" />
                                </div>
                            </div>
                            <div className="space-y-2">
                                <label className="text-xs text-[#a8a297] uppercase tracking-widest px-1">由誰預付</label>
                                <div className="flex flex-wrap gap-2">
                                    {members.map(m => <button key={m.name} onClick={() => setForm({...form, payer: m.name})} className={`px-4 py-2 rounded-xl border text-sm transition-all ${form.payer === m.name ? 'bg-[#5c6b53] border-[#5c6b53] text-white shadow-md' : 'bg-white border-[#e5e1d8] text-[#7a746a]'}`}>{m.name}</button>)}
                                </div>
                            </div>
                            <div className="space-y-2">
                                <label className="text-xs text-[#a8a297] uppercase tracking-widest px-1">誰要分攤</label>
                                <div className="flex flex-wrap gap-2">
                                    {members.map(m => <button key={m.name} onClick={() => setForm(prev => ({ ...prev, participants: prev.participants.includes(m.name) ? prev.participants.filter(p => p !== m.name) : [...prev.participants, m.name] }))} className={`px-4 py-2 rounded-xl border text-sm transition-all ${form.participants.includes(m.name) ? 'bg-[#f3f0e9] border-[#5c6b53] text-[#5c6b53]' : 'bg-white border-[#e5e1d8] text-[#7a746a]'}`}>{m.name}</button>)}
                                    <button onClick={() => setForm({...form, participants: members.map(m => m.name)})} className="text-sm text-[#5c6b53] font-black border-b-2 border-[#5c6b53]/30 px-2 ml-1">全選</button>
                                </div>
                            </div>
                            <button onClick={submitExpense} disabled={!form.item || !form.amount || !form.payer || form.participants.length === 0} className="w-full bg-[#5c6b53] text-white py-3 rounded-2xl text-lg shadow-lg font-black disabled:opacity-30 active:scale-95 transition-all">記錄並同步</button>
                        </section>

                        <section className="space-y-4">
                            <div className="flex justify-between items-center px-2">
                                <h2 className="text-lg font-bold flex items-center gap-2 text-[#5c6b53]"><Icon name="check-circle-2" /> 最終結算結餘</h2>
                                <button onClick={copyToClipboard} className="flex items-center gap-2 text-xs font-black text-white bg-[#5c6b53] px-4 py-2 rounded-full shadow-lg"><Icon name="copy" className="w-4 h-4" /> 複製清單</button>
                            </div>
                            <div className="bg-white rounded-[2rem] border border-[#e5e1d8] overflow-hidden shadow-md p-4 sm:p-5 space-y-4">
                                {settlement.transactions.map((t, i) => {
                                    const receiver = members.find(m => m.name === t.to);
                                    return (
                                        <div key={i} className="flex flex-col p-4 bg-[#fdfaf5] rounded-[1.5rem] border border-[#e5e1d8]/50 gap-3">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <div className="bg-white px-3 py-1.5 rounded-lg border border-[#e5e1d8] text-sm">{t.from}</div>
                                                    <Icon name="arrow-right" className="text-[#5c6b53] animate-pulse" />
                                                    <div className="bg-white px-3 py-1.5 rounded-lg border border-[#e5e1d8] text-sm">{t.to}</div>
                                                </div>
                                                <div className="text-xl font-black text-[#5c6b53]">TWD {Math.round(t.amount)}</div>
                                            </div>
                                            {receiver && receiver.bankInfo && (
                                                <div className="bg-white/60 p-3 rounded-xl border border-dashed border-[#5c6b53]/30 text-xs text-[#5c6b53] flex items-center justify-between">
                                                    <span>匯款至：{receiver.bankInfo}</span>
                                                    <button onClick={() => { navigator.clipboard.writeText(receiver.bankInfo); showToast("帳號已複製"); }} className="text-[#a8a297] hover:text-[#5c6b53]"><Icon name="copy" className="w-4 h-4" /></button>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                                {settlement.transactions.length === 0 && <div className="text-center py-10 text-[#a8a297] font-black border-4 border-dashed border-[#f3f0e9] rounded-[2rem]">目前無欠帳</div>}
                            </div>
                        </section>
                    </main>

                    {/* 設定匯款資訊彈窗 */}
                    {editingBank && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="bg-white rounded-[2.5rem] p-8 max-w-sm w-full shadow-2xl border border-[#e5e1d8] space-y-6 scale-up-center">
                                <div className="text-center">
                                    <h3 className="text-xl font-black text-[#5c6b53]">設定「{editingBank.name}」的帳戶</h3>
                                    <p className="text-[#a8a297] text-sm mt-1 font-bold">設定後，結算時將自動顯示此帳號</p>
                                </div>
                                <input type="text" value={editingBank.info} onChange={e => setEditingBank({...editingBank, info: e.target.value})} placeholder="例如：中信 (822) 12345..." className="w-full px-4 py-3 bg-[#fdfaf5] border border-[#e5e1d8] rounded-xl outline-none text-center" />
                                <div className="flex gap-3">
                                    <button onClick={() => setEditingBank(null)} className="flex-1 py-3 text-[#a8a297] font-black">取消</button>
                                    <button onClick={saveBankInfo} className="flex-1 py-3 bg-[#5c6b53] text-white rounded-xl shadow-lg">儲存帳戶</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Toast */}
                    {toast && <div className="fixed bottom-10 left-1/2 -translate-x-1/2 bg-[#4a4a4a] text-white px-8 py-4 rounded-2xl shadow-2xl z-[150] font-black text-sm animate-bounce">{toast}</div>}

                    {/* 登出確認 */}
                    {showLogoutConfirm && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="bg-white rounded-[2rem] p-8 max-w-sm w-full shadow-2xl text-center scale-up-center">
                                <h3 className="text-xl font-black text-[#5c6b53] mb-4">確定要登出嗎？</h3>
                                <p className="text-[#7a746a] text-sm mb-8 font-black">資料將保留在雲端，輸入代碼即可回來。</p>
                                <div className="flex flex-col gap-3">
                                    <button onClick={() => { localStorage.removeItem('my_trip_id'); setTripId(null); setShowLogoutConfirm(false); }} className="w-full py-4 bg-[#5c6b53] text-white font-black rounded-2xl">確認登出</button>
                                    <button onClick={() => setShowLogoutConfirm(false)} className="w-full py-3 text-[#a8a297] font-black">取消</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 清除全部 */}
                    {showClearConfirm && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="bg-white rounded-[2rem] p-8 max-w-sm w-full shadow-2xl text-center scale-up-center">
                                <h3 className="text-xl font-black text-red-500 mb-4">全部清除？</h3>
                                <p className="text-[#7a746a] text-sm mb-8 font-black">這會刪除此群組在雲端的所有明細與成員。</p>
                                <div className="flex flex-col gap-3">
                                    <button onClick={() => { updateCloud({ members: [], expenses: [] }); setShowClearConfirm(false); showToast("已清空"); }} className="w-full py-4 bg-red-500 text-white font-black rounded-2xl">確認清空</button>
                                    <button onClick={() => setShowClearConfirm(false)} className="w-full py-3 text-[#a8a297] font-black">取消</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>